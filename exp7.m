% START of section generated by exp6.R --->
%
r200 = [0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.20, 0.21];
r250 = [0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.20, 0.21];
r300 = [0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.20];
r350 = [0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.20];
r400 = [0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19];
r450 = [0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19];
r500 = [0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18];
r550 = [0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18];
r600 = [0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17];
r650 = [0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17];
r700 = [0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16];

lambda200 = [646.400232, 523.066650, 447.581035, 408.102119, 375.044092, 363.621299, 344.500484, 339.488821, 327.344084, 325.887023, 328.741221, 321.785747, 309.578571, 309.758055, 306.914781];
lambda250 = [687.923363, 581.109398, 506.581308, 488.280536, 460.405689, 458.037431, 439.149288, 431.630117, 419.590185, 404.661900, 406.350898, 394.701324, 391.110000, 390.078247, 390.862349];
lambda300 = [865.628491, 728.588423, 639.579533, 572.351969, 544.182981, 523.410771, 521.666851, 498.913734, 503.840667, 504.761993, 496.785509, 494.894469, 479.656764, 465.484938, 464.785951];
lambda350 = [929.390310, 769.523112, 701.443778, 638.872822, 603.359985, 602.226675, 599.480145, 582.807002, 571.800637, 560.351747, 560.177243, 561.328347, 550.378513, 541.098994, 552.473142];
lambda400 = [1258.046398, 964.900052, 830.418774, 742.004358, 677.025392, 671.735024, 669.368176, 670.651444, 667.278210, 663.278768, 648.432477, 630.437284, 625.868366, 617.501496, 616.232174];
lambda450 = [1323.195611, 1027.467841, 859.815732, 798.068979, 741.414074, 722.337164, 734.628038, 761.285805, 738.135250, 723.626281, 703.358891, 690.975613, 692.149934, 697.353953, 672.433895];
lambda500 = [1824.264020, 1340.593276, 1108.621913, 970.616783, 874.268032, 796.811238, 783.627313, 826.568499, 815.617978, 809.008378, 814.620458, 800.767263, 784.280522, 791.123023, 809.030135];
lambda550 = [1853.618510, 1418.438555, 1137.474311, 1014.326613, 935.271458, 871.565119, 871.548686, 905.044173, 897.111900, 903.072435, 877.103238, 886.322756, 873.655225, 855.476305, 848.082812];
lambda600 = [2988.331507, 1931.732423, 1423.920769, 1204.730539, 1098.144578, 1030.740273, 958.369671, 990.538912, 970.523945, 975.134456, 968.656325, 973.578922, 971.466516, 946.134743, 951.503754];
lambda650 = [3035.953013, 1969.654706, 1494.526843, 1264.975295, 1132.109339, 1069.185868, 1037.217766, 1032.500386, 1067.834358, 1056.246936, 1037.328063, 1040.368505, 1057.968254, 1042.168930, 1030.356314];
lambda700 = [6245.902074, 3076.925988, 1986.022973, 1552.989058, 1353.223217, 1247.357312, 1144.970009, 1133.236838, 1124.630715, 1112.990484, 1118.253164, 1104.879654, 1141.310585, 1126.441987, 1097.147325];

n_array = [200, 250, 300, 350, 400, 450, 500, 550, 600, 650, 700];

lambda007 = [646.400232, 687.923363, 728.588423, 769.523112, 830.418774, 859.815732, 970.616783, 1014.326613, 1098.144578, 1132.109339, 1247.357312];
lambda008 = [523.066650, 581.109398, 639.579533, 701.443778, 742.004358, 798.068979, 874.268032, 935.271458, 1030.740273, 1069.185868, 1144.970009];
lambda009 = [447.581035, 506.581308, 572.351969, 638.872822, 677.025392, 741.414074, 796.811238, 871.565119, 958.369671, 1037.217766, 1133.236838];
lambda010 = [408.102119, 488.280536, 544.182981, 603.359985, 671.735024, 722.337164, 783.627313, 871.548686, 990.538912, 1032.500386, 1124.630715];
lambda011 = [375.044092, 460.405689, 523.410771, 602.226675, 669.368176, 734.628038, 826.568499, 905.044173, 970.523945, 1067.834358, 1112.990484];
lambda012 = [363.621299, 458.037431, 521.666851, 599.480145, 670.651444, 761.285805, 815.617978, 897.111900, 975.134456, 1056.246936, 1118.253164];
lambda013 = [344.500484, 439.149288, 498.913734, 582.807002, 667.278210, 738.135250, 809.008378, 903.072435, 968.656325, 1037.328063, 1104.879654];
lambda014 = [339.488821, 431.630117, 503.840667, 571.800637, 663.278768, 723.626281, 814.620458, 877.103238, 973.578922, 1040.368505, 1141.310585];
lambda015 = [327.344084, 419.590185, 504.761993, 560.351747, 648.432477, 703.358891, 800.767263, 886.322756, 971.466516, 1057.968254, 1126.441987];
lambda016 = [325.887023, 404.661900, 496.785509, 560.177243, 630.437284, 690.975613, 784.280522, 873.655225, 946.134743, 1042.168930, 1097.147325];
%
% <-- END of section generated by exp6.R

x = [];
rpow = -3;
for i=1:size(r200, 2), x = [x, 200*r200(i)^rpow]; end
for i=1:size(r250, 2), x = [x, 250*r250(i)^rpow]; end
for i=1:size(r300, 2), x = [x, 300*r300(i)^rpow]; end
for i=1:size(r350, 2), x = [x, 350*r350(i)^rpow]; end
for i=1:size(r400, 2), x = [x, 400*r400(i)^rpow]; end
for i=1:size(r450, 2), x = [x, 450*r450(i)^rpow]; end
for i=1:size(r500, 2), x = [x, 500*r500(i)^rpow]; end
for i=1:size(r550, 2), x = [x, 550*r550(i)^rpow]; end
for i=1:size(r600, 2), x = [x, 600*r600(i)^rpow]; end
for i=1:size(r650, 2), x = [x, 650*r650(i)^rpow]; end
for i=1:size(r700, 2), x = [x, 700*r700(i)^rpow]; end

y = [lambda200, lambda250, lambda300, lambda350, lambda400, lambda450, lambda500, lambda550, lambda600, lambda650, lambda700];

% As both plots show, y cannot be a linear function of either n/r^2 or n/r^3

% When n is fixed, lambda can be modelled as a*r^q+t (trust-region robust),
% where q can be estimated to be, i.e. -3:
fprintf('Estimated q = %f\n', mean([-3.339, -2.923, -3.03, -3.271, -3.495, -3.794, -3.039, -3.098, -2.745, -2.84, -2.431]));
%fprintf('Estimated a = %f\n', mean([0.04837, 0.6896, 0.08003, 0.03819, 0.01983, 0.00738, 0.06065, 0.002199, 0.022, 0.01051, 0.09763]));

% So we can assume t is a function of n
% Found t seems to be a linear function of n, i.e., t = b*n + c (trust-region robust),
% where b = 1.607 and c = -22.28
t_array = [302.4, 365.3, 466.2, 544.6, 623.9, 694.2, 771.1, 865.7, 945.6, 1023, 1073];

% Try to estimate a, b and c again by fitting lambda = a*r^-3 + b*n + c (non-robust because robust doesn't work)
% Got a = a1*n + a2, where a1 = -0.000128, a2 = 0.1335 (robust: a1 = -0.0001224, a2 = 0.1304)
a_array = [0.1179, 0.1027, 0.08707, 0.0826, 0.0789, 0.07787, 0.06834, 0.06561, 0.05656, 0.05567, 0.0419];

% At this stage, we have lambda = (a1*n + a2)*r^-3 + b*n + c (L-M robust)
% We want to re-estimate b and c by fitting the above equation (where a1 and a2 are known)
b = mean([1.499, 1.542, 1.534, 1.525, 1.512, 1.503, 1.535, 1.541, 1.564, 1.565, 1.572]);
fprintf('Estimated b = %f\n', b);
c = mean([0.176, 0.1755, 0.175, 0.1747, 0.1744, 0.1742, 0.1741, 0.1739, 0.1739, 0.1738, 0.1737]);
fprintf('Estimated c = %f\n', c); 

% So lambda = (a1*n + a2)*r^-3 + b*n + c
a1 = -0.0001224;
a2 = 0.1304;
%b = 1.5; (above)
%c = 0.174; (above)
clf;
set(gcf, 'PaperPosition', [1, 1, 1, 1]);

n = 200;
r = r200(1):0.01:r200(size(r200,2));
subplot(3,4,1);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r200, lambda200, 'rx--')

n = 250;
r = r250(1):0.01:r250(size(r250,2));
subplot(3,4,2);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r250, lambda250, 'rx--')

n = 300;
r = r300(1):0.01:r300(size(r300,2));
subplot(3,4,3);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r300, lambda300, 'rx--')

n = 350;
r = r350(1):0.01:r350(size(r350,2));
subplot(3,4,4);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r350, lambda350, 'rx--')

n = 400;
r = r400(1):0.01:r400(size(r400,2));
subplot(3,4,5);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r400, lambda400, 'rx--')

n = 450;
r = r450(1):0.01:r450(size(r450,2));
subplot(3,4,6);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r450, lambda450, 'rx--')

n = 500;
r = r500(1):0.01:r500(size(r500,2));
subplot(3,4,7);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r500, lambda500, 'rx--')

n = 550;
r = r550(1):0.01:r550(size(r550,2));
subplot(3,4,8);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r550, lambda550, 'rx--')

n = 600;
r = r600(1):0.01:r600(size(r600,2));
subplot(3,4,9);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r600, lambda600, 'rx--')

n = 650;
r = r650(1):0.01:r650(size(r650,2));
subplot(3,4,10);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r650, lambda650, 'rx--')

n = 700;
r = r700(1):0.01:r700(size(r700,2));
subplot(3,4,11);
plot(r, (a1*n + a2)*r.^-3 + b*n + c, 'bo-', r700, lambda700, 'rx--')

